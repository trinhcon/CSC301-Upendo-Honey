# UPENDO HONEY (TEAM 3)

## Description 

 The overall application is a promotion app mobile web app. The user is supposed to receive
 an alphanumeric code from the label of a retail product made from our partner's honey. The
 product would also have a URL that takes the user to our website. From the landing page of
 our website the user can enter the alphanumeric code printed on the retail product's label.
 Entering the code will take them to a menu of customized flows of websites slides. Each
 code is related to a batch of honey made from beekeepers; one of whom has written their
 own letter to the customer. The customer will be able to choose between a variety of topics
 to explore further in each flow. After they are finished reading they can read a different
 topic by selecting another one from the main menu.


 The objective of the application is to promote tazanian honey and raise awareness to allow
 the partners to have premium on their sales. They want to publicize unique features of
 their honey and their manufacturing process; particularly how closely they work with their
 beekeepers to produce honey in wild environments. The reason they need this problem solved
 is because it is not currently transparent how companies produce their honey. Unlike
 other sources of honey, Upendo Honey harvest product comes from a fully natural source in
 the wild. Specific to a Tanzanian-based company, they will need their own publicity
 to compete with honey product manufacturers that are local to consumer but use worse
 honey harvesting practices.

 The special context to understand why this promotional app helps Upendo Honey solve
 this problem has to do with transparency and access. Honey companies in general do
 not have much publicity and they are not well-known to many consumers. Harvesting honey
 from domesticated sources, such as keep honey bees in "artificial hives" and isolated
 colonies can be very bad for those populations. There are also a number of environmental
 reasons why harvesting honey from the artificial sources can be detrimental. It requires
 a lot more resources to keep bees in pens/boxes rather than out in the wild. Many 
 customers may be eco-friendly or care about domestication of animals. Upendo Honey seeks
 to be transparent and advertise all of its best practices to show why they are distinguished
 from other companies. This project solves the problem of transparency by not only advertising
 practices, but they also allow for people to communicate with beekeepers! This can be done
 through the project's email form in the beekeeper flow. An email is sent, which allows them
 the beekeeper at Upendo Honey to email back (with the help of a translator). Therefore
 are customer can see for themselves what the beekeepers are like.

 In terms of access, many people who purchase from retailers may not understand the
 extent to how their honey is produced. They also may not have not understand the
 fact that their honey could be produced in a distant country like Tanzania. Hence,
 Upendo Honey needs some sort of promotion to advertise themselves to the customers
 of retailers overseas. This allows our partner to develop awareness and distinguish
 their honey from the honey of competing honey enterprises. This project solves
 this directly by being a mobile web app that promotes and explains the culture
 of Tanzanian Honey Harvesting to a customer from a distant country. The customer
 can understand the ecosystem in which honey is produced, and how Upendo Honey's
 production stands out when compared with the rest.


## Key Features
 
 Interactive features include:
  *  Entering a code in the landing page

The User will be able to acquire a code from the label of a Upendo Honey Product which they
can then enter into the input to be taken to a customized experience. The code will
determine what they see, but if they do not have one, there is a standard code "PUREJOY"
that is provided. If a user would like to see more, they'll have to somehow acquire
more codes, or they'll have to proceed to one of the company's external links. These
links are embedded within the flow of the customized experience. Here is
a link to the website showing the landing page:

http://upendo.herokuapp.com/


  * Being able to select the flow for their preferred topic from the menu page and be able to slide back and forth
 between slides in their selected flow. 

Each User may be interested in a company for different things. So the user can choose whichever
topic they want to explore the most. If they happen to change their mind there can always swipe
or click back to the menu page. After they're done a flow, they can choose to proceed down another one.
At any visit to the menu page they will also be able to go to Upendo Honey's external links to learn
more about their company. Here is a link taking you to a sample menu page:

http://upendo.herokuapp.com/app/PUREJOY/menu

 * Beekeepers will be able to describe their lives in Tanzania

Many Beekeepers in Tanzania likely live a very different life than those 
purchasing honey for retail stores. Users will be able to see glimpse into their lives
through letters the beekeepers will write to customers of Upendo Honey.
They will be able to see a handwritten letter in the beekeeper's native language
(language depends on beekeeper) and have a translation side-by-side to understand the
message. The user will also be able to see a portrait of the beekeeper and
perhaps even some family members in the picture. Below is a link that
will show a sample beekeeper flow:

http://upendo.herokuapp.com/app/PUREJOY/beekeeper

  * Submitting a form to send an email back to the beekeeper

Some customers will want to get to know the people who work for the company and more about
their lives as beekeepers. They will be able to ask here about the beekeeper's
experiences and understand what kind of people beekeepers are. A particularly
active user might even want to send a message to the beekeeper they see.
This project has a form submission which does just that. The form allows the
user to send a response to the beekeeper. This will send an email to Upendo Honey
which they will then relay to the appropriate beekeeper based on the code that
was entered. This email will also allow the customer to put in their email and
let them hav a continuous conversation! From there the beekeeper and user can
keep communicating as they wish. Below is a link that will take you to
this exact form! Feel free to contact the beekeeper if you wish, but at the
moment the beekeeper themselves aren't prepared to respond. (A Translator
would be required).

http://upendo.herokuapp.com/app/PUREJOY/beekeeper-message

  * Being able to access any point in the application through a valid URL. This means that a URL
    can be used to share specific portions of the application. This even allows the URL to be stored in a QR code!

Some users will care about specific slides. For example, someone who wants to cook
recipes using honey might want to share the slide with the link that leads to a recipe site
managed by the partner. Our project allows a user to directly take the URL that they
have in the browser's search bar and share it with someone else. This also means that
our company can create QR codes to distribute to consumers. Simply said, this feature
allows the promotional app to be easily shared in a modular fashion. They can get the
URL to any page in the entire app. Experiences using the same URL will be the same,
down to even the beekeeper that they can email or interact with.

**In fact, I've been using this feature to share links with you all this time!**

(Please Note: the external link to the recipe site is not part of this project,
 in addition, our partner may not have made that external website yet, so the
 link works, but may take you to a not yet valid URL).

 * Learn about Honey

Many users may purchase honey, but not all of them will understand how special
of a substance honey really is. Even more so, they might not even know that there
are different types of honey! The project contains a flow that does just that:
develops awareness about honey, its propeties and what you can do with it. Be it
in recipes, health benefits or how it's harvested, this app explains much of them
to the user. The user can even go to the aforementioned link for new recipes.

Each flow for the honey can actually be customized specific to the specific
alphanumeric code that was entered. This way each type of batch of honey can
stand out. Whether it's amber honey or light honey, our partner to give
descriptions of why it's a healthier substitute for sugar and what those
differences mean in their purchases. Feel free to see view about honey in the
link below:


http://upendo.herokuapp.com/app/PUREJOY/honey-type

  * Mobile users can slide their phones screens, while desktop users can use buttons instead. (Responsive Web Deisgn)

Many users in the modern age may be more interested in using their phones instead of
using a desktop/laptop to view the promotional app. Because of this our web app
allows mobile users to see a smaller version that simplifies much of the application.
In addition, mobile users can even slide to move through flows! The app is responsive
an re-organizes features to be resized based on the phone's screen. Pages with more
information are also broken down so that the experience is more streamlined ofr 
mobile users. All features work in the mobile version, how some visuals have
been removed or turned into additional slides to avoid cluterring the view.


Feel free go on your phone to check this feature!
If you're on google chrome or fire fox press "Ctrl + Shift + M" to use this
feature.

Note: if you've never used this feature before you might instead have to
press "Ctrl + Shift + I" and then select the phone screen size option.
You then choose a phone size.

**IMPORTANT: if you change from desktop to mobile or vice versa on one of these
browsers (thus changing screen size). It may be required that you refresh the
page to see a flow properly. This is NOT a bug with our app, it is a bug
on these browsers that we have little to no control of. Furthermore, if you're
using a track pad, you may find it more difficult to slide accross the screen.
Please use a phone if you want to test this feature rigorously. The built-in
browser features by Google/Firefox will not always accurately simulate behaviour**

Regular users don't use dev tools to artificially change their screen sizes interally in a browser.
So this isn't a problem with regular use.




## Instructions
 * Clear instructions for how to use the application from the end-user's perspective
 * How do you access it? Are accounts pre-created or does a user register? Where do you start? etc. 
 * Provide clear steps for using each feature described above
 * This section is critical to testing your application and must be done carefully and thoughtfully

 Go to "https://upendo.herokuapp.com/".
 From here you can enter any code that you've received from the label of a product
 made by Upendo's Honey. If you do not have a code you can use the standard "PUREJOY"
 code that is noted in the landing page's description. Once your code is entered,
 you will be taken to a menu page that let's you choose between a variety of topics
 to learn more about Upendo Honey products. You can see visual instructions with
 futher detail here:

 https://docs.google.com/presentation/d/1YXgv6fKqbHHqO_NwWbpQZcSZwGc7oiDAD5OdNMmT-uU/edit#slide=id.g8c5a0b2258_0_60

  Each **Page** in a flow can be accessed directly by a user through a URL. This means
 that if a user wants to share a particular page of the flow customized by the code,
 they can simply share the URL. Thus URL can also be embedded in a QR code and
 will present the exact same information that would be displayed by the sharing user.
 
 
 These flows are customized for each
 code. Currently, only the beekeeper and honey flow are fully complete. A user can
 select either of those icons to progress thhrough these flows and learn more about
 the company's beekeepers or facts about honey. To progress through the flows the
 user will need to use the side arrows on desktop, or use slide left and/or right
 on a mobile phone. This is the general use of the application.
 
 Some slides will have additional features other than visual data. For instance the
 beekeeper flow contains an email form which uses EmailJS. The user can enter their
 name, email and a message that they would like to send to their beekeeper. After
 clicking the send button, a description will replace their message to let them
 know if the message was sent properly or not. The user can then continue on to
 other slides. Below is a guide for if you want to see what you can do using
 our application in its current state:

 https://docs.google.com/presentation/d/14ge2cc_WHHQDZXmIVQo_zPPMB0elhVJOYOH_eFPr0MY/edit#slide=id.p

 If a user wants to explore more about the product they just purchased,
 they can instead enter the honey flow. Here they can explore the various
 types of honey and slide through all of the snippets of information. The user
 will be able to click on arrows (or slide on mobile) to progress through the
 flow. Each page will contacts facts about the honey, its harvest and its
 health benefits.
 For a more detailed view of these features for honey please check below:

 https://docs.google.com/presentation/d/1SqeWMD3049lmZ5GyvDO1r3Bj-3drNB-vO209qeX1PmE/edit#slide=id.p


 To be clear: There is NO need for a user to have done any registration or have done
 anything prior to use. Any user can use the "PUREJOY" basic code and any user can
 also use a code found on the label of one of Upendo Honey's products.

 This summarizes all of the current user features implemented in full for D2.
 Much of the user experienced is selected by the administrator who chooses what
 is presented on a slide to the user. There is an entire administrative interface
 to input data into the database, as well as new flow data for other alphanumeric
 codes so that the partner can customize the experience of the user based
 entirely on the codes provided by them. Most of the **user's** features are
 visual because the is a **promotional application** meaning while there are
 some interactive features, the application is meant to have information flow
 mostly in one direction: towards the user.

 To properly assess the development we would also like to briefly mention the
 the administrative interface because this is where most of the work is
 implemented. If you think of a tv commercial, most of the work is done by
 the people behind the scenes, not necessarily the "end-user". With that
 justification we will explain the administrative interface too. We can
 customize the text in each of the flows using properties that are changed
 in the backend administrative database interface. This includes uploading
 any images and text messages of the partner's choosing. Much of our work
 was in allowing the partner to have this flexibility in making each flow
 for each beekeeper or batch of honey.

 You can access the backend at: https://upendo.herokuapp.com/admin/
 Where you can login with the credentials provided to you on slack.
 From there you will see a screen where to can add or modify database
 table instances. This means that you can directly control what the user
 sees. After modifying or creating a flow here, you can go to the original
 app landing page and enter the code of the flow you modified/created.
 This will take you to the new/updated flow that you just configured using
 our backend interface. If you're having trouble accessing try using the
 following slideshow to help you get running as an administrator:

 https://docs.google.com/presentation/d/1kzDzG5dxzzIRL_KTbq3IKy1xlxBxLi0KlIRaljXSJ0U/edit#slide=id.p

 You can see how the information is accessed from backend through the user
 interface from frontend by viewing the apis we've implemented. To do this,
 simply go to: https://upendo.herokuapp.com/api/v1/ and select the REST api
 that you want to view directly. The information provided is indeed public
 so you will be able to see the data displayed on the frontend website, here
 instead. The batchmember api translates the code into a key for each of the
 flows. The other flows take these keys to return the information specific
 to the alphanumeric code that was previously entered in the landing page.

 You can go to: https://upendo.herokuapp.com/api/v1/batch-members/PUREJOY/
 for an example of what would be returned. If you are logged in as an
 administrator, you could make changes. Otherwise, you are unable to make
 changes if your are not authenticated.

 If you want to access our latest version, please simply prepend "staging-"
 before "upendo.herokapp.com". Meaning: "https://staging-upendo.herokuapp.com/"
 would be the website to visit. It has all of the different aforementioned
 paths such as the api, BUT it connects to a different database. This means
 that you would need to create a different admin user to see access the
 admin interface. This also means that it has some "down time", because
 we are consistently uploading new code and developments. This is not meant
 to be the most stable version but to be the most recent version. It is not
 yet meant for production.

 
## Development Requirements

### Tech Stack

*Backend*:

* Python 3.7+
* Django
* Postgres

For details on the Python requirements, please see [requirements.txt](../../requirements.txt)


*Frontend*:

* Node.js (for the build)
* React

For details on the frontend requirements, see [package.json](../../upendo-frontend/package.json)


 ### How Do We Develop Locally?

 Please follow the detailed instructions in the [main readme](../../README.md)


 ### How Do we Deploy To Our Staging and Production Servers?

 Please follow the detailed instructions below under the subtitle "Deployment and Github Workflow"

 ### What if I Want to Deploy to Another Server?

 1. Set up two servers:

 * A server to run the backend and build the frontend. This will need Python 3.7+ and Node.js 12+
 * A Postgres database

2. Configure the environment variables as defined in the [main readme](../../README.md)

3. Install the Python requirements by running `pip install -r requirements.txt`

4. Running Django migrations using `python manage.py migrate`

5. Run `npm install` from the project root to build the frontend

6. Run `python manage.py collectstatic` to allow Django to serve the frontend files

7. Start up the web server using the command: `gunicorn upendo.wsgi --log-file -
 
 ## Deployment and Github Workflow

 ### How Do We Deploy?

 An overview of the deployment workflow was provided in the [main README](../../README.md).

 This document will go into more details, and explain reasoning for the decisions.

 ### Goals

 1. Iterate often, through small + frequent deployments
 2. Catch bugs early
 3. Keep production stable server stable for partner
 4. Keep staging server stable for team members
 5. Keep the flow as simple as possible
 6. Keep costs to $0


### Our Solution

1. Have a production-like development environment

* Accomplished using Docker Compose, and having the same, locked-in versions of Python, Python Requirements, and Postgres as we'd be using in Production
* Eliminates instances of "it works on my machine". If something is to fail in production, we want it to fail locally to allow us to catch and repair issues without disrupting others' workflow

2. Use a feature branch for your core development, which branches off of the master branch

* Feature branches make it easy to keep track of what's being developed
* Branching off of master aims to have us only one "step" or code change/commit away from the staging server
* Agreement between developers to keep feature branches small, and to deploy often to meet this goal and to reduce painful merge conflicts

3. Create a Pull Request to Master when you've completed your feature

* This triggers a CircleCI build
* Build instructions are defined in [circle.yml](../../.circleci/config.yml)
* CircleCI will run the unit tests and attempt to build the application
* This allows us to avoid failed builds to staging, and breaking the staging server
* CircleCI was chosen over Heroku Pipeline because it was free (whereas Heroku Pipeline was not)
* CircleCI was chosen over Github Actions because we found Github Actions to be a little slow (when working on A1)

* This also triggers a deployment of a [Heroku Review App](https://devcenter.heroku.com/articles/github-integration-review-apps)
* Heroku will deploy the branch to another server once CircleCI's build & tests are complete, and will throw a link up to the Github PR page to the deployed server
* We poke around in the deployed branch to ensure that the application behaves as expected
* The review apps share the same server as the staging server, to avoid having to populate the database with test data for each review app
* If something weird or unexpected is happening, the developer is expected to fix the code locally and push up their changes again. This will trigger a new CI build and a fresh deployment of the review app, allowing it to be re-tested
* Heroku Review Apps were chosen because they are a free feature that is not offered by CircleCI or Github Actions, and allow us to verify the veracity of our changes before merging into staging

4. Peer review of PR

* We have a private slack channel for the team where we post a link to PRs we've opened
* Team members are expected to review and comment on the PR, either in the private slack channel or on the PR itself
* Team members are given 24 hours for feedback, after which changes are merged. We've been good at providing timely feedback so far. No one has been blocked by having to wait for PR feedback

5. Merge the PR

* After unit tests and the CI build passes, the heroku app succeeds, and the PR has been peer reviewed, the developer can merge their branch to master
* Github has a feature which mandates that PRs be manually approved before merging. We did not turn this on because we trusted each other to be responsible, and found Slack as an easier medium to have conversations about the PRs than Github's PR interface.
* Developers try to "squash commits" and to rebase off master before/when merging to make the commit history as easy to read as possible.

6. Automated staging build

* Heroku is configured to listen to changes to the master branch and to deploy to the [upendo staging server](https://staging-upendo.herokuapp.com)
* When a PR is merged, a new commit is added to the master branch, which triggers an automated deployment to the staging server
* Migrations are run and Django static assets are collected as part of the build. No manual steps are needed. The build to staging is completely automated
* If any part of the build, migration, or static file collection (which includes running the react build and tests) fail, the entire build would fail, stopping faulty code from being pushed to production
* Ashwin receives an email notification whenever a build fails, and he looks into it. So far this has only happened if a developer accidentally overwrote or forgot to create a migration fail for the databse

* At this point, it may be sensible to ask why we don't have a development server and we merge directly to staging
* We were confident enough that our local Docker setup, our CircleCI builds, Heroku's review apps, and our manual PR review process allow us to catch enough bugs that if a feature branch's code passes these four steps, it's safe enough to merge to staging
* If we were a larger team across multiple departments, it might make more sense to cretae a development and/or integration environment before the staging environment. Given how small and cohesive our team was and given the additional safeguards we'd put in place, we opted for a simpler flow that allowed us to iterate quickly

7. Creating a Github Release / Git Tab

 * Around once every 7-10 days, we create a new release to production

 * This is done through Github Actions and Github's [release functionality](https://github.com/csc301-summer-2020/team-project-3-upendo-honey/releases).
 * When a team member is ready to deploy to production, they create a Github Release
 * Github releases are just wrappers around Git's Tag functionality. When a release is created, a tag is also created and appended to the latest commit in the master branch
 * A [Github Action](../../.github/workflows/deploy-prod.yml) is configured to listen for new tags to the master branch
 * When a new tag is detected, the Github Action [will deploy the master branch](https://github.com/csc301-summer-2020/team-project-3-upendo-honey/actions) to the production server

 * We wanted to automate as much of the production deployment process as possible while still controlling when to deploy to production. To keep the production server stable, we didn't want to automatically deploy every change to production
 * We opted for Git tags instead of another branch to enable simplicity. Developers only had to work off a single branch (i.e. master), but could still create a release whenever they wanted

 * We did this through Github Actions instead of Heroku or CircleCI because it was the most straightforward way to do it.
 * An open source Github Action existed for Heroku deployments, and could read the Heroku API key from the Github Repo's "secrets" section, which allows us to keep the production server more secure (by not checking the API key into source code)


### How We can Improve

* We believe this workflow achieves a balance between speed and stability (e.g. master branch + Git tags), and via security and usability (e.g. storing API keys securely + one-click production deployments).
* We've also accomplished this without using any paid functionality
* The main downside of this flow is that to leverage the functionality without paying any fees, we had to use three different tools (Heroku, CircleCI, Github Actions)
* If we had a larger budget, we could centralize functionality in a single service to make it easier for new developers to onboard


 ## Licenses 

 We will be applying the **GNU General Public License v3.0** to the project repository
 This decision had absolutely no effect on the development and use of our codebase.
 The choice of license had no effect whatsoever on development. This is because it
 is irrelevant to the development team how a third party uses the code.

 Let us explain further: the goal of the overall app is be a promotional mobile
 web app. This means that we want to reach the largest possible audience of
 users. If a third-party wishes to copy and redistrubute part of our promotion,
 it would be in the benefit of Upendo Honey. This would only increase the number
 of interactivity and exposure for the company. It is irrelevant that these
 users copy our code as it does not possess any particular commercial value
 if it is limited to us.

 Our partner was the one who made this choice. They chose GNU GPL v3.0 because it
 was simply a standard licence used by many open source software repositories and
 Upendo honey had no particular need to conceal its codebase. They decided that
 simply following many other developers in using this common licence was the best
 choice for them. They feel since so many people use this licence, it would be 
 good practice to do so too. They quite literally said there was not much
 other reason.
 

